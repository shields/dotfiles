#!/usr/bin/perl
#
# mail2page
# Michael Shields <shields@msrl.com>
# $Id$
#

use IO::Handle;
use Mail::Header;
use Mail::Field::AddrList;
use strict;

die "usage: mail2page NUMBER\n"
    if $#ARGV != 0;

$ENV{PATH} .= ":/usr/local/bin";

my $head = new Mail::Header \*STDIN;

my $phone = shift;

my $from_obj = Mail::Field->new('From', $head->get('From'));
my $from = join ' ', $from_obj->addresses();

chomp(my $subject = $head->get('Subject'));
$subject =~ s/^Re:\s*//;

my $message;
defined read(STDIN, $message, 4096)
    or die "couldn't read message: $!\n";

exec "$ENV{HOME}/bin/attpage", $phone, $from,
     (length $subject ? "($subject)\n".$message : $message);
die "couldn't exec attpage: $!\n";
