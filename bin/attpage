#!/usr/bin/perl
#
# attpage 2003-02-02
# Michael Shields <shields@msrl.com>
#

use LWP::UserAgent;
use HTTP::Request::Common qw(POST);

die "usage: attpage TEN_DIGIT FROM_EMAIL MESSAGE...\n"
    unless $#ARGV >= 2;

$number = shift @ARGV;
if ($number =~ /^(\d\d\d)(\d\d\d)(\d\d\d\d)$/) { $number = "$1-$2-$3"; }
$number =~ /^\d\d\d-\d\d\d-\d\d\d\d$/
    or die "bad format for number: $number\n";

$from_email = shift @ARGV;

#$message = join('//', @ARGV);
#$message =~ y/\r\n//d;
$message = join("\n", @ARGV);
# AT&T claims the limit is 110, but actually it is the complete SMS
# of 160 (but that is including the length of the email address.)
$message = substr($message, 0, 160);

$ua = new LWP::UserAgent;
$req = POST 'http://www.mobile.att.net/messagecenter/pagersend.cgi',
            [ pin => $number, message => $message,
	      from => $from_email, subject => '' ];
$res = $ua->request($req);
unless ($res->is_success) {
    print $res->as_string();
    exit 1;
}

exit 0;
