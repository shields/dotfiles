#!/usr/bin/perl
#
# checkwebchange
# Michael Shields <shields@msrl.com>
# $Id$
#

use DB_File;
use Fcntl;
use LWP::Simple;
use strict;

$#ARGV == 0
    or die "usage: checkwebchange URL\n";
my $url = $ARGV[0];

tie my %cache, 'DB_File', "$ENV{HOME}/.checkwebchange",
    O_CREAT|O_RDWR, 0600
    or die "couldn't tie: $!\n";

my @a = head($url);
scalar @a or die "couldn't get $url\n";

my $last_modified = $a[2]
    or die "no last-modified on $url\n";

print "Page changed:\n$url\n"
    if $cache{$url} && $last_modified > $cache{$url};

$cache{$url} = $last_modified;

untie %cache
    or die "couldn't untie: $!\n";

exit 0;
